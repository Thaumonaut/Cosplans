$ vitest run tests/unit/
[dotenv@17.2.3] injecting env (13) from .env.test -- tip: âš™ï¸  write to custom object with { processEnv: myObject }
10:10:42 PM [vite-plugin-svelte] The following packages have a svelte field in their package.json but no exports condition for svelte.

svelte-teleport@0.1.1

Please see https://github.com/sveltejs/vite-plugin-svelte/blob/main/docs/faq.md#missing-exports-condition for details.
The following Vite config options will be overridden by SvelteKit:
  - base
[baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`

[1m[46m RUN [49m[22m [36mv4.0.8 [39m[90m/home/jek/Documents/projects/Cosplans[39m

[90mstdout[2m | tests/unit/api/services/team-service.test.ts
[22m[39mâœ“ Unit test setup complete

[90mstderr[2m | tests/unit/api/services/team-service.test.ts[2m:79:5[22m[2m[2m > [22m[2mteamService[2m > [22m[2mcreate[2m > [22m[2mshould prevent creating multiple personal teams
[22m[39mFailed to ensure user profile exists: TypeError: __vite_ssr_import_0__.supabase.from(...).select(...).eq(...).maybeSingle is not a function
    at Object.create [90m(/home/jek/Documents/projects/Cosplans/[39msrc/lib/api/services/teamService.ts:186:10[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m

 [31mâ¯[39m tests/unit/api/services/team-service.test.ts [2m([22m[2m9 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 495[2mms[22m[39m
[31m       [31mÃ—[31m should create a team with owner as member[39m[32m 358[2mms[22m[39m
       [32mâœ“[39m should prevent creating multiple personal teams[32m 43[2mms[22m[39m
       [32mâœ“[39m should invite a user to a team with status=invited[32m 50[2mms[22m[39m
       [32mâœ“[39m should throw error if user already exists as member[32m 8[2mms[22m[39m
       [32mâœ“[39m should update invitation status from invited to active[32m 17[2mms[22m[39m
       [32mâœ“[39m should throw error if invitation not found[32m 2[2mms[22m[39m
       [32mâœ“[39m should update member role (owner only)[32m 2[2mms[22m[39m
       [32mâœ“[39m should remove a member from team[32m 2[2mms[22m[39m
       [32mâœ“[39m should return team members with user profiles[32m 3[2mms[22m[39m
[90mstdout[2m | tests/unit/api/services/resource-service.test.ts
[22m[39mâœ“ Unit test setup complete

[90mstdout[2m | tests/unit/auth/auth-service.test.ts
[22m[39mâœ“ Unit test setup complete

(node:494598) Warning: `--localstorage-file` was provided without a valid path
(Use `node --trace-warnings ...` to show where the warning was created)
(node:494621) Warning: `--localstorage-file` was provided without a valid path
(Use `node --trace-warnings ...` to show where the warning was created)
[90mstdout[2m | tests/unit/smoke.spec.ts
[22m[39mâœ“ Unit test setup complete

[90mstdout[2m | tests/unit/stores/ideas.test.ts
[22m[39mâœ“ Unit test setup complete

 [32mâœ“[39m tests/unit/auth/auth-service.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 12[2mms[22m[39m
 [32mâœ“[39m tests/unit/smoke.spec.ts [2m([22m[2m1 test[22m[2m)[22m[32m 15[2mms[22m[39m
[90mstdout[2m | tests/unit/stores/teams.test.ts
[22m[39mâœ“ Unit test setup complete

[90mstdout[2m | tests/unit/api/services/task-service.test.ts
[22m[39mâœ“ Unit test setup complete

[90mstdout[2m | tests/unit/api/services/idea-service.test.ts
[22m[39mâœ“ Unit test setup complete

(node:494599) Warning: `--localstorage-file` was provided without a valid path
(Use `node --trace-warnings ...` to show where the warning was created)
[90mstderr[2m | tests/unit/api/services/idea-service.test.ts[2m:190:3[22m[2m[2m > [22m[2mideaService (TDD)[2m > [22m[2mshould convert an idea to a project
[22m[39mFailed to delete idea after conversion: __vite_ssr_import_0__.supabase.from(...).update is not a function

 [32mâœ“[39m tests/unit/api/services/idea-service.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 34[2mms[22m[39m
(node:494622) Warning: `--localstorage-file` was provided without a valid path
(Use `node --trace-warnings ...` to show where the warning was created)
(node:494620) Warning: `--localstorage-file` was provided without a valid path
(Use `node --trace-warnings ...` to show where the warning was created)
 [32mâœ“[39m tests/unit/api/services/resource-service.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 31[2mms[22m[39m
 [32mâœ“[39m tests/unit/stores/teams.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m tests/unit/stores/ideas.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 10[2mms[22m[39m
 [31mâ¯[39m tests/unit/api/services/task-service.test.ts [2m([22m[2m20 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 216[2mms[22m[39m
       [32mâœ“[39m should return all tasks for current team[32m 173[2mms[22m[39m
[31m       [31mÃ—[31m should filter by completed status[39m[32m 4[2mms[22m[39m
       [32mâœ“[39m should filter by priority[32m 2[2mms[22m[39m
       [32mâœ“[39m should handle errors[32m 2[2mms[22m[39m
       [32mâœ“[39m should return tasks for a specific project[32m 2[2mms[22m[39m
       [32mâœ“[39m should return standalone tasks when projectId is null[32m 2[2mms[22m[39m
       [32mâœ“[39m should filter by resourceId[32m 2[2mms[22m[39m
       [32mâœ“[39m should filter by stageId[32m 2[2mms[22m[39m
       [32mâœ“[39m should return a single task by ID[32m 2[2mms[22m[39m
       [32mâœ“[39m should return null for non-existent task[32m 1[2mms[22m[39m
       [32mâœ“[39m should throw error for other errors[32m 1[2mms[22m[39m
       [32mâœ“[39m should create a new task with required fields[32m 2[2mms[22m[39m
       [32mâœ“[39m should throw error if no team is selected[32m 2[2mms[22m[39m
       [32mâœ“[39m should use provided teamId if provided[32m 3[2mms[22m[39m
       [32mâœ“[39m should derive teamId from project if projectId provided and no teamId[32m 5[2mms[22m[39m
       [32mâœ“[39m should update an existing task[32m 3[2mms[22m[39m
       [32mâœ“[39m should handle partial updates[32m 1[2mms[22m[39m
       [32mâœ“[39m should handle stageId changes[32m 1[2mms[22m[39m
       [32mâœ“[39m should soft delete a task[32m 1[2mms[22m[39m
       [32mâœ“[39m should hard delete a task (deprecated)[32m 1[2mms[22m[39m

[31mâ¯â¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Tests 2 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m tests/unit/api/services/task-service.test.ts[2m:157:5[22m[2m > [22mtaskService[2m > [22mlistAll[2m > [22mshould filter by completed status
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ â€¦(2) ][90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m tests/unit/api/services/task-service.test.ts:[2m183:28[22m[39m
    [90m181| [39m
    [90m182| [39m      [34mexpect[39m(tasks)[33m.[39m[34mtoHaveLength[39m([34m1[39m)[33m;[39m
    [90m183| [39m      expect(baseQuery.eq).toHaveBeenCalledWith('task_stages.is_compleâ€¦
    [90m   | [39m                           [31m^[39m
    [90m184| [39m    })[33m;[39m
    [90m185| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/2]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/api/services/team-service.test.ts[2m:44:5[22m[2m > [22mteamService[2m > [22mcreate[2m > [22mshould create a team with owner as member
[31m[1mAssertionError[22m: expected undefined to be 'private' // Object.is equality[39m

[32m- Expected:[39m 
"private"

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m tests/unit/api/services/team-service.test.ts:[2m71:27[22m[39m
    [90m 69| [39m
    [90m 70| [39m      [34mexpect[39m(result[33m.[39mname)[33m.[39m[34mtoBe[39m([32m'Test Team'[39m)[33m;[39m
    [90m 71| [39m      [34mexpect[39m(result[33m.[39mtype)[33m.[39m[34mtoBe[39m([32m'private'[39m)[33m;[39m
    [90m   | [39m                          [31m^[39m
    [90m 72| [39m      expect(mockSupabase.rpc).toHaveBeenCalledWith('create_team_safe'â€¦
    [90m 73| [39m        team_name[33m:[39m [32m'Test Team'[39m[33m,[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/2]â¯[22m[39m


[2m Test Files [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m6 passed[39m[22m[90m (8)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m57 passed[39m[22m[90m (59)[39m
[2m   Start at [22m 22:10:42
[2m   Duration [22m 7.52s[2m (transform 5.92s, setup 1.84s, collect 11.83s, tests 821ms, environment 20.76s, prepare 185ms)[22m

[1m[7m[35m HTML [39m[27m[22m [35mReport is generated[39m
[2m       You can run [22m[1mnpx vite preview --outDir html[22m[2m to see the test results.[22m
close timed out after 10000ms
Tests closed successfully but something prevents Vite server from exiting
You can try to identify the cause by enabling "hanging-process" reporter. See https://vitest.dev/config/#reporters
error: script "test:unit" exited with code 1
